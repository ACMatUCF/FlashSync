<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class DropboxClient::ChunkedUploader - RDoc Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>build/dropbox-ruby-sdk-1.5.1/lib/dropbox_sdk.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-finish">#finish</a>
    
    <li><a href="#method-i-upload">#upload</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../DropboxClient.html">DropboxClient</a>
  
    <li><a href="../DropboxClient/ChunkedUploader.html">DropboxClient::ChunkedUploader</a>
  
    <li><a href="../DropboxAuthError.html">DropboxAuthError</a>
  
    <li><a href="../DropboxError.html">DropboxError</a>
  
    <li><a href="../DropboxNotModified.html">DropboxNotModified</a>
  
    <li><a href="../DropboxSession.html">DropboxSession</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class DropboxClient::ChunkedUploader</h1>

  <div id="description" class="description">
    
<p><a href="ChunkedUploader.html">ChunkedUploader</a> is responsible for
uploading a large file to Dropbox in smaller chunks. This allows large
files to be uploaded and makes allows recovery during failure.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-client" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">client</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-file_obj" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">file_obj</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-offset" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">offset</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-total_size" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">total_size</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-upload_id" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">upload_id</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(client, file_obj, total_size)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File build/dropbox-ruby-sdk-1.5.1/lib/dropbox_sdk.rb, line 418</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">file_obj</span>, <span class="ruby-identifier">total_size</span>)
    <span class="ruby-ivar">@client</span> = <span class="ruby-identifier">client</span>
    <span class="ruby-ivar">@file_obj</span> = <span class="ruby-identifier">file_obj</span>
    <span class="ruby-ivar">@total_size</span> = <span class="ruby-identifier">total_size</span>
    <span class="ruby-ivar">@upload_id</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@offset</span> = <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-finish" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">finish</span><span
            class="method-args">(to_path, overwrite=false, parent_rev=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Completes a file upload</p>

<p>Args:</p>
<ul><li>
<p>to_path: The directory path to upload the file to. If the destination
directory does not yet exist, it will be created.</p>
</li><li>
<p>overwrite: Whether to overwrite an existing file at the given path.
[default is False] If overwrite is False and a file already exists there,
Dropbox will rename the upload to make sure it doesn’t overwrite
anything. You must check the returned metadata to know what this new name
is. This field should only be True if your intent is to potentially clobber
changes to a file that you don’t know about.</p>
</li><li>
<p>parent_rev: The rev field from the ‘parent’ of this upload. If your
intent is to update the file at the given path, you should pass the
parent_rev parameter set to the rev value from the most recent metadata you
have of the existing file at that path. If the server has a more recent
version of the file at the specified path, it will automatically rename
your uploaded file, spinning off a conflict. Using this parameter
effectively causes the overwrite parameter to be ignored. The file will
always be overwritten if you send the most-recent parent_rev, and it will
never be overwritten you send a less-recent one.</p>
</li></ul>

<p>Returns:</p>
<ul><li>
<p>A Hash with the metadata of file just uploaded. For a detailed description
of what this call returns, visit: <a
href="https://www.dropbox.com/developers/reference/api#metadata">www.dropbox.com/developers/reference/api#metadata</a></p>
</li></ul>
          

          
          <div class="method-source-code" id="finish-source">
            <pre><span class="ruby-comment"># File build/dropbox-ruby-sdk-1.5.1/lib/dropbox_sdk.rb, line 482</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">finish</span>(<span class="ruby-identifier">to_path</span>, <span class="ruby-identifier">overwrite</span>=<span class="ruby-keyword">false</span>, <span class="ruby-identifier">parent_rev</span>=<span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">commit_chunked_upload</span>(<span class="ruby-identifier">to_path</span>, <span class="ruby-ivar">@upload_id</span>, <span class="ruby-identifier">overwrite</span>, <span class="ruby-identifier">parent_rev</span>)
    <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">response</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- finish-source -->
          
        </div>

        

        
      </div><!-- finish-method -->

    
      <div id="method-i-upload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">upload</span><span
            class="method-args">(chunk_size=4*1024*1024)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Uploads data from this ChunkedUploader’s <a
href="ChunkedUploader.html#attribute-i-file_obj">#file_obj</a> in chunks,
until an error occurs. Throws an exception when an error occurs, and can be
called again to resume the upload.</p>

<p>Args:</p>
<ul><li>
<p>chunk_size: The chunk size for each individual upload.  Defaults to 4MB.</p>
</li></ul>
          

          
          <div class="method-source-code" id="upload-source">
            <pre><span class="ruby-comment"># File build/dropbox-ruby-sdk-1.5.1/lib/dropbox_sdk.rb, line 432</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">chunk_size</span>=<span class="ruby-value">4</span>*<span class="ruby-value">1024</span>*<span class="ruby-value">1024</span>)
    <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>

    <span class="ruby-keyword">while</span> <span class="ruby-ivar">@offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@total_size</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">last_chunk</span>
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-ivar">@file_obj</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">chunk_size</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">resp</span> = {}
        <span class="ruby-keyword">begin</span>
            <span class="ruby-identifier">resp</span> = <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">parse_response</span>(<span class="ruby-ivar">@client</span>.<span class="ruby-identifier">partial_chunked_upload</span>(<span class="ruby-identifier">last_chunk</span>, <span class="ruby-ivar">@upload_id</span>, <span class="ruby-ivar">@offset</span>))
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">DropboxError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
            <span class="ruby-identifier">resp</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">http_response</span>.<span class="ruby-identifier">body</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-string">'offset'</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-string">'offset'</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@offset</span>
            <span class="ruby-ivar">@offset</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>] <span class="ruby-operator">-</span> <span class="ruby-ivar">@offset</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>]
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@upload_id</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-string">'upload_id'</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'upload_id'</span>]
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- upload-source -->
          
        </div>

        

        
      </div><!-- upload-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

